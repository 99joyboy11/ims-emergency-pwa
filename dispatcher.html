<!DOCTYPE html>
<html>
<head>
<title>Dispatcher IMS</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
#map{
height:600px;
}
</style>

</head>

<body>

<h2>Dispatcher Control Room</h2>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

const map = L.map("map").setView([14.5995,120.9842],12);

L.tileLayer(
"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
).addTo(map);

let dispatchMarker = null;

function loadIncident(){

const incident =
JSON.parse(localStorage.getItem("activeIncident"));

if(!incident) return;

if(!dispatchMarker){

dispatchMarker = L.marker([
incident.lat,
incident.lng
]).addTo(map)
.bindPopup(`
<b>Incoming Emergency Call</b><br>
Status: ${incident.status}<br>

<button onclick="answerCall()">
Answer Call
</button>
`);

map.setView([incident.lat, incident.lng],16);

}

}

function answerCall(){

let incident =
JSON.parse(localStorage.getItem("activeIncident"));

incident.status = "answered";

localStorage.setItem(
"activeIncident",
JSON.stringify(incident)
);

alert("Call Answered");

window.location.href =
"YOUR_YEASTAR_CALL_LINK";

}

setInterval(loadIncident,2000);

</script>

</body>
</html>
