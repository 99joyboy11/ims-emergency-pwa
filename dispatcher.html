<!DOCTYPE html>
<html>
<head>
<title>Dispatcher IMS</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
#map{
    height:600px;
}
</style>
</head>

<body>

<h2>Dispatcher Control Room</h2>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

let map = L.map("map").setView([14.5995,120.9842],12);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")
.addTo(map);

let markers = {};

async function loadIncidents(){

    // Mock database (GitHub JSON)
    const res = await fetch("data/incidents.json");
    const incidents = await res.json();

    incidents.forEach(i=>{

        if(!markers[i.id]){

            let marker = L.marker([i.lat,i.lng]).addTo(map);

            marker.bindPopup(`
                <b>Incident ${i.id}</b><br>
                Status: ${i.status}<br>
                <button onclick="answerCall()">
                Answer Call
                </button>
            `);

            markers[i.id] = marker;
        }

    });

}

function answerCall(){

    window.location.href =
    "YOUR_YEASTAR_CALL_LINK";

}

setInterval(loadIncidents,3000);
loadIncidents();

</script>

</body>
</html>
