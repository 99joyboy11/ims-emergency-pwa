<!DOCTYPE html>
<html>
<head>
<title>Dispatcher Control Room</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
#map{
height:600px;
}
</style>

</head>

<body>

<h2>Dispatcher Control Room</h2>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

const map = L.map("map")
.setView([14.5995,120.9842],12);

L.tileLayer(
"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
).addTo(map);

let dispatchMarker = null;

function loadCall(){

const call =
JSON.parse(localStorage.getItem("activeCall"));

if(!call) return;

if(!dispatchMarker){

dispatchMarker = L.marker([call.lat,call.lng])
.addTo(map)
.bindPopup(`
<b>Incoming Emergency Call</b><br>

Status: ${call.status}<br>

<button onclick="answerCall()">
Answer Call
</button>
`);

map.setView([call.lat,call.lng],16);

}

}

function answerCall(){

let call =
JSON.parse(localStorage.getItem("activeCall"));

call.status = "answered";

localStorage.setItem(
"activeCall",
JSON.stringify(call)
);

alert("Call Answered");

window.location.href =
"YOUR_YEASTAR_CALL_LINK";

}

setInterval(loadCall,2000);

</script>

</body>
</html>
