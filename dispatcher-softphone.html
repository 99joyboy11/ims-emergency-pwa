<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dispatcher Control Room</title>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>

body{
margin:0;
font-family:Arial;
background:#111;
color:white;
text-align:center;
}

#map{
height:600px;
}

.toolbar{
padding:20px;
background:#222;
}

button{
padding:12px 25px;
margin:10px;
font-size:16px;
}

#status{
color:#0f0;
font-size:18px;
}

</style>

</head>

<body>

<div class="toolbar">

<h2>Dispatcher Console</h2>

<div id="status">Waiting for call...</div>

<button onclick="answerCall()">
Answer Call
</button>

<button onclick="hangupCall()">
Hangup
</button>

</div>

<div id="map"></div>

<script>

const map = L.map("map")
.setView([14.5995,120.9842],12);

L.tileLayer(
"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
).addTo(map);

let marker = null;

////////////////////////////////////////////////////
// POLL CALL SESSION
////////////////////////////////////////////////////

function checkIncomingCall(){

const call =
JSON.parse(localStorage.getItem("activeCall"));

if(!call) return;

document.getElementById("status").innerText =
"Incoming Call ðŸ””";

if(marker){

marker.setLatLng([call.lat, call.lng]);

}else{

marker = L.marker([call.lat, call.lng])
.addTo(map)
.bindPopup("Caller Location");

map.setView([call.lat, call.lng],16);

}

}

////////////////////////////////////////////////////

function answerCall(){

let call =
JSON.parse(localStorage.getItem("activeCall"));

if(!call){
alert("No incoming call");
return;
}

call.status = "answered";

localStorage.setItem(
"activeCall",
JSON.stringify(call)
);

alert("Call Answered ðŸŽ§");

// Replace with PBX call pickup logic if needed

}

function hangupCall(){
alert("Call ended");
}

setInterval(checkIncomingCall,2000);

</script>

</body>
</html>
