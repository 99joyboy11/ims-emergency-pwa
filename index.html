<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Citizen Emergency</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>

body{
margin:0;
font-family:Arial;
background:#111;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.container{
width:380px;
height:780px;
background:white;
border-radius:40px;
display:flex;
flex-direction:column;
overflow:hidden;
}

.header{
text-align:center;
color:red;
font-size:24px;
padding:30px;
font-weight:bold;
}

#map{
flex:1;
}

#callBtn{
background:red;
color:white;
border:none;
padding:25px;
font-size:20px;
cursor:pointer;
}

</style>

</head>

<body>

<div class="container">

<div class="header">
Emergency Call
</div>

<div id="map"></div>

<button id="callBtn">
ðŸ“ž Call Dispatcher
</button>

</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

let locationData = null;

// Map
const map = L.map("map").setView([0,0],2);

L.tileLayer(
"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
).addTo(map);

let marker = null;

// GPS Tracking
navigator.geolocation.watchPosition(pos=>{

locationData = {
lat: pos.coords.latitude,
lng: pos.coords.longitude
};

map.setView([locationData.lat, locationData.lng],16);

if(marker){
marker.setLatLng([locationData.lat, locationData.lng]);
}else{
marker = L.marker([
locationData.lat,
locationData.lng
]).addTo(map);
}

});

// Call Button
document.getElementById("callBtn").onclick = function(){

if(!locationData){
alert("Waiting for GPS");
return;
}

// Create Call Session
const sessionId = Date.now().toString();

const callData = {
sessionId,
lat: locationData.lat,
lng: locationData.lng,
status:"calling"
};

localStorage.setItem(
"activeCall",
JSON.stringify(callData)
);

// Replace with your PBX WebRTC Call Link
window.location.href =
"YOUR_YEASTAR_CALL_LINK";

};

</script>

</body>
</html>
